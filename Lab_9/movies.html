<!DOCTYPE html>
<html>

<head>
    <style>
        fieldset {
            border-radius: 10px;
        }
        input{ border: none;}
        textarea{text-overflow: ellipsis;
            max-height: 200px;width: 200px;}
    </style>
</head>

<body onload="initArr()">
    <header>
        <img src="./Studio_Ghibli_logo.svg" width="200">
        <section>
            <!-- filter section-->
            <form>
                <fieldset>
                    <label for="title">Title:</label>
                    <input type="text" id="title"><br>

                    <label for="year">Year:</label>
                    <input type="text" id="year"><br>

                    <label for="length">Length:</label>
                    <input type="text" id="length"><br>

                    <label for="rating">Rating:</label>
                    <input type="text" id="rating"><br>

                    <label for="recommended">Recommended:</label>
                    <input type="text" id="recommended"><br>

                    <label for="Synopsis">Synopsis:</label>
                    <textarea id="Synopsis"></textarea><br><br>

                    <p id="info"></p><br>
                    <input id='firstBtn' type="button" value="First" onclick='goFirst()'>
                    <input id='prevBtn' type="button" value="Prev" onclick='goPrev()'>
                    <input id='nextBtn' type="button" value="Next" onclick='goNext()'>
                    <input id='lastBtn' type="button" value="Last" onclick='goLast()'>
                    <input id='searchBtn' type="button" value="search">
                </fieldset>
                <div id="printout"></div>
            </form>
        </section>


        <script>


            class SGmovie {
                // title;
                // year;
                // length;
                // rating;
                // Synopsis;
                // recommended;

                constructor(title, year, rating, length, Synopsis, recommended) {
                    this.title = title;
                    this.year = year;
                    this.length = length;
                    this.rating = rating;
                    this.Synopsis = Synopsis;
                    this.recommended = recommended;
                }
            }


            var myJSON;

            function initArr() {
                var movieArr = [];

                var SGmovie1 = new SGmovie("Spirited Away", 2001, "PG", "2h 5m", "10-year-old Chihiro and her parents stumble upon a seemingly abandoned amusement park. After her mother and father are turned into giant pigs, Chihiro meets the mysterious Haku, who explains that the park is a resort for supernatural beings who need a break from their time spent in the earthly realm, and that she must work there to free herself and her parents.", false);
                var SGmovie2 = new SGmovie("Kiki's Delivery Service", 1989, "G" ,"1h 43m", "This is the story of a young witch, named Kiki who is now 13 years old. But she is still a little green and plenty headstrong, but also resourceful, imaginative, and determined. With her trusty wisp of a talking cat named Jiji by her side she's ready to take on the world, or at least the quaintly European seaside village she's chosen as her new home.", true);
                var SGmovie3 = new SGmovie("My Neighbor Totoro", 1988, "G", "1h 26m", "Two young girls, 10-year-old Satsuki and her 4-year-old sister Mei, move into a house in the country with their father to be closer to their hospitalized mother. Satsuki and Mei discover that the nearby forest is inhabited by magical creatures called Totoros (pronounced toe-toe-ro). They soon befriend these Totoros, and have several magical adventures.", false);
                var SGmovie4 = new SGmovie("Howl's Moving Castle", 2004, "PG", "1h 59m", "A love story between an 18-year-old girl named Sophie, cursed by a witch into an old woman's body, and a magician named Howl. Under the curse, Sophie sets out to seek her fortune, which takes her to Howl's strange moving castle. In the castle, Sophie meets Howl's fire demon, named Karishifâ. Seeing that she is under a curse, the demon makes a deal with Sophie--if she breaks the contract he is under with Howl, then Karushifâ will lift the curse that Sophie is under, and she will return to her 18-year-old shape.", true);
                var SGmovie5 = new SGmovie("Ponyo", 2008, "G", "1h 41m", "A five-year-old boy develops a relationship with Ponyo, a young goldfish princess who longs to become a human after falling in love with him.", true);

                movieArr[0] = SGmovie1;
                movieArr[1] = SGmovie2;
                movieArr[2] = SGmovie3;
                movieArr[3] = SGmovie4;
                movieArr[4] = SGmovie5;

                myJSON = JSON.stringify(movieArr);
                document.getElementById('printout').innerHTML = myJSON


            }

            function displayObj(obj) {
                document.getElementById('title').value = obj.title;
                document.getElementById('year').value = obj.year;
                document.getElementById('length').value = obj.length;
                document.getElementById('rating').value = obj.rating;
                document.getElementById('Synopsis').innerText = obj.Synopsis;
                document.getElementById('recommended').value = obj.recommended;
                document.getElementById("printout").value = myJSON;
            }

            function displayPageNum() {
                document.getElementById("info").innerHTML = "Results " + (currIndex + 1) + "/" + allMoviesArr.length;
            }

            var allMoviesArr;
            var currIndex = 0; //curr index of displayed movie 
            var httpRequest;

            function goNext() {
                if (currIndex == allMoviesArr.length - 1) {
                    return;
                }
                else {
                    currIndex += 1;
                    displayPageNum();
                }
                displayObj(allMoviesArr[currIndex]);
            }

            function goPrev() {
                if (currIndex == 0) {
                    return;
                }
                else {
                    currIndex -= 1;
                    displayPageNum();
                }
                displayObj(allMoviesArr[currIndex]);
            }

            function goFirst() {
                displayObj(allMoviesArr[0]);
                displayPageNum();
            }

            function goLast() {
                currIndex = allMoviesArr.length - 1;
                displayObj(allMoviesArr[currIndex]);
                displayPageNum();
            }

            //---------------
            function loadJSON() {
                httpRequest = new XMLHttpRequest(); // create the object
                if (!httpRequest) { // check if the object was properly created
                    // issues with the browser, example: old browser
                    alert('Cannot create an XMLHTTP instance');
                    return false;
                }
                httpRequest.onreadystatechange = alertContents; // we assign a function to the property onreadystatechange (callback function)
                httpRequest.open('GET', 'myjson.json'); // Use a file in reference to the page where you are!
                httpRequest.send(); // GET = send with no parameter !
            }

            function alertContents() {
                try {
                    if (httpRequest.readyState === XMLHttpRequest.DONE) {
                        if (httpRequest.status === 200) {
                            let str = httpRequest.responseText;
                            allMoviesArr = JSON.parse(str);    // str to Obj
                            displayObj(allMoviesArr[currIndex]);
                            displayPageNum(currIndex);
                        } else {
                            alert('There was a problem with the request.');
                        }
                    }
                }
                catch (e) { // Always deal with what can happen badly, client-server applications --> there is always something that can go wrong on one end of the connection
                    alert('Caught Exception: ' + e.Synopsis);
                }
            }
            loadJSON();

        </script>


        <footer>footer</footer>
</body>

</html>